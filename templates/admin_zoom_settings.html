{% extends "base.html" %}

{% block title %}Admin Zoom Settings - Metabolomics Platform{% endblock %}

{% block extra_css %}
<style>
    .settings-container {
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        max-width: 800px;
        margin: 0 auto;
    }
    
    .settings-header {
        background: linear-gradient(135deg, var(--primary-blue), var(--light-blue));
        color: white;
        padding: 40px 30px;
        text-align: center;
        position: relative;
    }
    
    .settings-header::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 100%;
        height: 100%;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="10" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="80" r="15" fill="rgba(255,255,255,0.05)"/></svg>');
        opacity: 0.3;
    }
    
    .settings-icon {
        width: 80px;
        height: 80px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        font-size: 32px;
        color: white;
        backdrop-filter: blur(10px);
    }
    
    .settings-title {
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 8px;
        position: relative;
        z-index: 2;
    }
    
    .settings-subtitle {
        font-size: 16px;
        opacity: 0.9;
        margin-bottom: 0;
        position: relative;
        z-index: 2;
    }
    
    .settings-body {
        padding: 40px;
    }
    
    .current-settings {
        background: rgba(46, 76, 146, 0.05);
        border-radius: 12px;
        padding: 20px;
        border-left: 4px solid var(--primary-orange);
        margin-bottom: 30px;
    }
    
    .current-settings h6 {
        color: var(--primary-blue);
        font-weight: 600;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .setting-display {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .setting-label {
        font-weight: 600;
        color: #495057;
    }
    
    .setting-value {
        color: var(--primary-blue);
        font-family: 'Courier New', monospace;
        font-weight: 600;
        background: #f8f9fa;
        padding: 4px 12px;
        border-radius: 6px;
    }
    
    .form-section {
        margin-bottom: 30px;
    }
    
    .section-title {
        color: var(--primary-blue);
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .section-title i {
        color: var(--primary-orange);
    }
    
    .form-label {
        color: var(--dark-text);
        font-weight: 500;
        margin-bottom: 8px;
    }
    
    .form-control {
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 12px 15px;
        font-size: 15px;
        transition: all 0.3s ease;
        font-family: 'Courier New', monospace;
    }
    
    .form-control:focus {
        border-color: var(--primary-blue);
        box-shadow: 0 0 0 0.2rem rgba(46, 76, 146, 0.15);
    }
    
    .input-group-text {
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        color: #6c757d;
        font-weight: 500;
    }
    
    .submit-section {
        text-align: center;
        padding-top: 20px;
        border-top: 1px solid #e9ecef;
    }
    
    .submit-btn {
        background: linear-gradient(135deg, var(--primary-orange), var(--light-orange));
        border: 2px solid var(--primary-orange);
        color: white;
        padding: 15px 40px;
        border-radius: 50px;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(233, 75, 0, 0.2);
    }
    
    .submit-btn:hover {
        background: linear-gradient(135deg, var(--light-orange), var(--primary-orange));
        border-color: var(--light-orange);
        color: white;
        transform: translateY(-3px);
        box-shadow: 0 6px 25px rgba(233, 75, 0, 0.4);
    }
    
    .cancel-btn {
        background: transparent;
        border: 2px solid #6c757d;
        color: #6c757d;
        padding: 15px 30px;
        border-radius: 50px;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.3s ease;
        margin-right: 15px;
    }
    
    .cancel-btn:hover {
        background: #6c757d;
        color: white;
    }
    
    .info-box {
        background: #e3f2fd;
        border: 1px solid #bbdefb;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
        border-left: 4px solid #2196f3;
    }
    
    .info-box i {
        color: #1976d2;
        margin-right: 8px;
    }
    
    .info-box p {
        margin: 0;
        color: #1565c0;
        font-size: 14px;
        line-height: 1.5;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-5">
    <div class="settings-container">
        <!-- Header Section -->
        <div class="settings-header">
            <div class="settings-icon">
                <i class="fas fa-search-plus"></i>
            </div>
            <h1 class="settings-title">Chart Zoom Settings</h1>
            <p class="settings-subtitle">Configure default zoom range for all chart visualizations</p>
        </div>
        
        <!-- Body Section -->
        <div class="settings-body">
            <!-- Current Settings Display -->
            <div class="current-settings">
                <h6>
                    <i class="fas fa-chart-line"></i>
                    Current Zoom Configuration
                </h6>
                <div class="setting-display">
                    <span class="setting-label">Zoom Start Time:</span>
                    <span class="setting-value">{{ "%.2f"|format(zoom_start) }} minutes</span>
                </div>
                <div class="setting-display">
                    <span class="setting-label">Zoom End Time:</span>
                    <span class="setting-value">{{ "%.2f"|format(zoom_end) }} minutes</span>
                </div>
                <div class="setting-display">
                    <span class="setting-label">Total Range:</span>
                    <span class="setting-value">{{ "%.2f"|format(zoom_end - zoom_start) }} minutes</span>
                </div>
            </div>
            
            <!-- Information Box -->
            <div class="info-box">
                <i class="fas fa-info-circle"></i>
                <p>
                    <strong>How it works:</strong> These settings control the default zoom range applied to all chart visualizations. 
                    Users can still manually zoom and pan, but this sets the initial view. 
                    Settings are applied immediately to all new chart views.
                </p>
            </div>
            
            <!-- Settings Form -->
            <form method="POST" action="{{ url_for('update_zoom_settings') }}">
                <div class="form-section">
                    <h5 class="section-title">
                        <i class="fas fa-sliders-h"></i>
                        Zoom Range Configuration
                    </h5>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="zoom_start" class="form-label">Start Time (minutes)</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="zoom_start" name="zoom_start" 
                                           value="{{ zoom_start }}" step="0.01" min="0" max="20" required>
                                    <span class="input-group-text">min</span>
                                </div>
                                <div class="form-text">Minimum retention time for default view</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="zoom_end" class="form-label">End Time (minutes)</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="zoom_end" name="zoom_end" 
                                           value="{{ zoom_end }}" step="0.01" min="0.1" max="30" required>
                                    <span class="input-group-text">min</span>
                                </div>
                                <div class="form-text">Maximum retention time for default view</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-box">
                        <i class="fas fa-lightbulb"></i>
                        <p>
                            <strong>Recommended ranges:</strong> 
                            • Full view: 0.0 - 16.0 minutes (default)<br>
                            • Focused view: 8.0 - 12.0 minutes (common lipid retention range)<br>
                            • Custom view: Set based on your specific analysis requirements
                        </p>
                    </div>
                </div>
                
                <!-- Submit Section -->
                <div class="submit-section">
                    <a href="{{ url_for('admin_dashboard') }}" class="cancel-btn">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                    <button type="submit" class="submit-btn">
                        <i class="fas fa-save"></i> Save Settings
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// Form validation
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const startInput = document.getElementById('zoom_start');
    const endInput = document.getElementById('zoom_end');
    
    function validateRange() {
        const start = parseFloat(startInput.value);
        const end = parseFloat(endInput.value);
        
        if (start >= end) {
            endInput.setCustomValidity('End time must be greater than start time');
        } else {
            endInput.setCustomValidity('');
        }
    }
    
    startInput.addEventListener('input', validateRange);
    endInput.addEventListener('input', validateRange);
    
    form.addEventListener('submit', function(e) {
        validateRange();
        if (!form.checkValidity()) {
            e.preventDefault();
        }
    });
});
</script>
{% endblock %}